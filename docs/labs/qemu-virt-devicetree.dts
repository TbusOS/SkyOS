/*
 * QEMU ARM virt machine设备树示例
 * 这个文件展示了QEMU virt machine的硬件布局
 * 
 * 生成命令: 
 * qemu-system-arm -machine virt -cpu cortex-a15 -machine dumpdtb=virt.dtb
 * dtc -I dtb -O dts virt.dtb > qemu-virt-devicetree.dts
 */

/dts-v1/;

/ {
    interrupt-parent = <0x8001>;
    #size-cells = <0x02>;
    #address-cells = <0x02>;
    compatible = "linux,dummy-virt";

    psci {
        migrate = <0x84000005>;
        cpu_on = <0x84000003>;
        cpu_off = <0x84000002>;
        cpu_suspend = <0x84000001>;
        method = "hvc";
        compatible = "arm,psci-0.2", "arm,psci";
    };

    memory@40000000 {
        reg = <0x00 0x40000000 0x00 0x10000000>;
        device_type = "memory";
    };

    platform@c000000 {
        interrupt-parent = <0x8001>;
        ranges = <0x00 0x00 0xc000000 0x2000000>;
        #address-cells = <0x01>;
        #size-cells = <0x01>;
        compatible = "qemu,platform", "simple-bus";
    };

    fw-cfg@9020000 {
        dma-coherent;
        reg = <0x00 0x9020000 0x00 0x18>;
        compatible = "qemu,fw-cfg-mmio";
    };

    virtio_mmio@a000000 {
        dma-coherent;
        interrupts = <0x00 0x10 0x01>;
        reg = <0x00 0xa000000 0x00 0x200>;
        compatible = "virtio,mmio";
    };

    gpio@9030000 {
        phandle = <0x8003>;
        gpio-controller;
        #gpio-cells = <0x02>;
        compatible = "arm,pl061", "arm,primecell";
        clock-names = "apb_pclk";
        clocks = <0x8000>;
        interrupts = <0x00 0x07 0x04>;
        reg = <0x00 0x9030000 0x00 0x1000>;
    };

    pl011@9000000 {
        clock-names = "uartclk", "apb_pclk";
        clocks = <0x8000 0x8000>;
        interrupts = <0x00 0x01 0x04>;
        reg = <0x00 0x9000000 0x00 0x1000>;
        compatible = "arm,pl011", "arm,primecell";
    };

    pcie@10000000 {
        interrupt-map-mask = <0x1800 0x00 0x00 0x07>;
        interrupt-map = <0x00 0x00 0x00 0x01 0x8001 0x00 0x00 0x00 0x03 0x04 
                         0x00 0x00 0x00 0x02 0x8001 0x00 0x00 0x00 0x04 0x04 
                         0x00 0x00 0x00 0x03 0x8001 0x00 0x00 0x00 0x05 0x04 
                         0x00 0x00 0x00 0x04 0x8001 0x00 0x00 0x00 0x06 0x04>;
        ranges = <0x1000000 0x00 0x00 0x00 0x3eff0000 0x00 0x10000 
                  0x2000000 0x00 0x10000000 0x00 0x10000000 0x00 0x2eff0000>;
        reg = <0x00 0x3f000000 0x00 0x1000000>;
        msi-parent = <0x8002>;
        dma-coherent;
        bus-range = <0x00 0xff>;
        linux,pci-domain = <0x00>;
        #size-cells = <0x02>;
        #address-cells = <0x03>;
        device_type = "pci";
        compatible = "pci-host-ecam-generic";
    };

    pl031@9010000 {
        clock-names = "apb_pclk";
        clocks = <0x8000>;
        interrupts = <0x00 0x02 0x04>;
        reg = <0x00 0x9010000 0x00 0x1000>;
        compatible = "arm,pl031", "arm,primecell";
    };

    cpus {
        #size-cells = <0x00>;
        #address-cells = <0x01>;

        cpu@0 {
            reg = <0x00>;
            next-level-cache = <0x8004>;
            compatible = "arm,cortex-a15";
            device_type = "cpu";
        };
    };

    timer {
        interrupts = <0x01 0x0d 0xf04 0x01 0x0e 0xf04 0x01 0x0b 0xf04 0x01 0x0a 0xf04>;
        always-on;
        compatible = "arm,armv7-timer";
    };

    apb-pclk {
        phandle = <0x8000>;
        clock-output-names = "clk24mhz";
        clock-frequency = <0x16e3600>;
        #clock-cells = <0x00>;
        compatible = "fixed-clock";
    };

    intc@8000000 {
        phandle = <0x8001>;
        reg = <0x00 0x8000000 0x00 0x10000 0x00 0x8010000 0x00 0x10000>;
        compatible = "arm,gic-400";
        ranges;
        #size-cells = <0x02>;
        #address-cells = <0x02>;
        interrupt-controller;
        #interrupt-cells = <0x03>;

        v2m@8020000 {
            phandle = <0x8002>;
            reg = <0x00 0x8020000 0x00 0x1000>;
            msi-controller;
            compatible = "arm,gic-v2m-frame";
        };
    };

    chosen {
        stdout-path = "/pl011@9000000";
    };

    l2-cache {
        phandle = <0x8004>;
        compatible = "cache";
    };
};

/*
 * 关键硬件信息提取:
 * 
 * 1. 内存布局:
 *    - 主内存: 0x40000000 - 0x4FFFFFFF (256MB)
 *    - GIC:    0x08000000 - 0x0801FFFF
 *    - UART:   0x09000000 - 0x09000FFF  
 *    - GPIO:   0x09030000 - 0x09030FFF
 *    - RTC:    0x09010000 - 0x09010FFF
 *    - PCIe:   0x10000000 - 0x3EFEFFFF
 * 
 * 2. 中断配置:
 *    - UART0: IRQ 1 (0x00 0x01 0x04)
 *    - RTC:   IRQ 2 (0x00 0x02 0x04)  
 *    - GPIO:  IRQ 7 (0x00 0x07 0x04)
 * 
 * 3. 时钟配置:
 *    - APB时钟: 24MHz (0x16e3600 = 24000000)
 * 
 * 4. 处理器配置:
 *    - ARM Cortex-A15
 *    - ARMv7-A架构
 *    - L2缓存支持
 */ 